{% extends 'base.html' %}

{% block js_docready %}
$(".buyproduct").click( function() {
	$.get("/ajax/addproduct/" + this.id, function(data) 
	{
		if (data == "OK")
		{
			$(".buyproduct").effect("transfer", {to: $(".arrowicon")}, 750);
		}
		else
		{
			alert(data);
		}
    });
});

$(".do_grade").click( function() {
	rating = $("#grade").val();
	url = "/ajax/addrating/" + this.id + "/" + rating;
	$.get(url, function(data)
	{
		if (data == "Denied")
		{
			alert("You have already rated this product");
		}
		else
		{
			alert("Thank you for voting!"); // TODO: Something other than alert()
		}
	});
});
{% endblock %}

{% block main %}
<h1>{{ asset.name|capfirst }}</h1>
<h2>{{ asset.description }}</h2>

{% if asset.image %}
{% load static %}
<img src="{% get_media_prefix %}/{{ asset.image }}" />
{% endif %}

<p> This is where the detailed description will go once it is enabled</p>
<p>(and an image should go somewhere too)</p>

<p>{{ asset.price }} kr</p>
<button class="buyproduct" id="{{ asset.pk }}">Buy</button>

{% if rating %}
<p>Grade: {{ rating.0 }} ({{rating.1}} votes)</p>
{% endif %}
<!-- TODO: Only show this for logged in users -->
<p>Rate this product:<select id="grade">
		<option value="1">1</option>
		<option value="2">2</option>
		<option value="3">3</option>
		<option value="4">4</option>
		<option value="5">5</option>
	</select>
	<button class="do_grade" id="{{ asset.pk }}">Rate</button>
</p>
{% endblock %}
